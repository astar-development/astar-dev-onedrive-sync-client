<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:syncronisation="using:AStar.Dev.OneDrive.Client.Syncronisation"
             xmlns:models1="clr-namespace:AStar.Dev.OneDrive.Client.Core.Models;assembly=AStar.Dev.OneDrive.Client.Core"
             xmlns:converters="using:AStar.Dev.OneDrive.Client.Converters"
             x:Class="AStar.Dev.OneDrive.Client.Syncronisation.SyncTreeViewColorful"
             x:DataType="syncronisation:SyncTreeViewModel">

    <Design.DataContext>
        <syncronisation:SyncTreeViewModel />
    </Design.DataContext>

    <UserControl.Resources>
        <converters:BooleanNegationConverter x:Key="BooleanNegationConverter"/>
    </UserControl.Resources>

    <Grid RowDefinitions="Auto,*,Auto">
        <!-- Header -->
        <StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,24">
            <Grid ColumnDefinitions="*,Auto">
                <TextBlock Grid.Column="0" Text="ðŸ“ Folder Selection" FontSize="26" FontWeight="Black">
                    <TextBlock.Foreground>
                        <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,0%">
                            <GradientStop Color="#667eea" Offset="0"/>
                            <GradientStop Color="#764ba2" Offset="1"/>
                        </LinearGradientBrush>
                    </TextBlock.Foreground>
                </TextBlock>
                <Button Grid.Column="1" Content="ðŸ—‘ï¸ Clear All" Command="{Binding ClearSelectionsCommand}"
                        Background="#FF6B6B" Foreground="White" CornerRadius="16"
                        Padding="16,8" FontWeight="Bold" VerticalAlignment="Center"/>
            </Grid>
            <TextBlock Text="Pick the folders you want to sync! âœ¨" FontSize="14" Foreground="#666666"/>
        </StackPanel>

        <!-- Tree View -->
        <Border Grid.Row="1" CornerRadius="16" Padding="16" BoxShadow="0 4 12 0 #20000000">
            <Border.Background>
                <LinearGradientBrush StartPoint="0%,0%" EndPoint="0%,100%">
                    <GradientStop Color="#F0F4FF" Offset="0"/>
                    <GradientStop Color="#FFEEF8" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <ScrollViewer>
                <TreeView ItemsSource="{Binding Folders}" SelectionMode="Single" Background="Transparent" BorderThickness="0">
                    <TreeView.Styles>
                        <Style Selector="TreeViewItem" x:DataType="models1:OneDriveFolderNode">
                            <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
                            <Setter Property="Padding" Value="8,8"/>
                        </Style>
                    </TreeView.Styles>

                    <TreeView.ItemTemplate>
                        <TreeDataTemplate ItemsSource="{Binding Children}" x:DataType="models1:OneDriveFolderNode">
                            <Border Background="#40FFFFFF" CornerRadius="8" Padding="8,6">
                                <StackPanel Orientation="Horizontal" Spacing="12">
                                    <CheckBox IsChecked="{Binding IsSelected}" IsThreeState="True" VerticalAlignment="Center"/>
                                    <TextBlock Text="ðŸ“‚" FontSize="16" VerticalAlignment="Center"/>
                                    <ProgressBar Width="14" Height="14" IsIndeterminate="True" IsVisible="{Binding IsLoading}" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding Name}" FontSize="14" FontWeight="SemiBold"
                                               Foreground="#333333" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                        </TreeDataTemplate>
                    </TreeView.ItemTemplate>
                </TreeView>
            </ScrollViewer>
        </Border>

        <!-- Footer Actions -->
        <Grid Grid.Row="2" Margin="0,20,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0" Content="{Binding SyncButtonText}" Command="{Binding StartSyncCommand}"
                    MinWidth="140" Margin="0,0,12,0" Height="50" CornerRadius="25" FontWeight="Bold"
                    FontSize="15" Foreground="White" BorderThickness="0"
                    IsEnabled="{Binding IsLoading, Converter={StaticResource BooleanNegationConverter}}">
                <Button.Background>
                    <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                        <GradientStop Color="#4FACFE" Offset="0"/>
                        <GradientStop Color="#00F2FE" Offset="1"/>
                    </LinearGradientBrush>
                </Button.Background>
            </Button>

            <Button Grid.Column="1" Content="ðŸ“Š Show Progress" Command="{Binding OpenSyncProgressCommand}"
                    MinWidth="140" Margin="0,0,12,0" Height="50" Background="#40FFFFFF"
                    Foreground="#667eea" BorderBrush="#667eea" BorderThickness="2"
                    CornerRadius="25" FontWeight="Bold"
                    IsVisible="{Binding IsSyncing}" IsEnabled="{Binding !IsSyncProgressOpen}"/>

            <Button Grid.Column="2" Content="âŒ Cancel" Command="{Binding CancelSyncCommand}"
                    MinWidth="120" Margin="0,0,12,0" Height="50" Background="#FF6B6B"
                    Foreground="White" BorderThickness="0" CornerRadius="25" FontWeight="Bold"
                    IsVisible="{Binding IsSyncing}"/>

            <!-- Status Info -->
            <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="16"
                        HorizontalAlignment="Right" VerticalAlignment="Center">
                <!-- Progress -->
                <Border Background="#40FFFFFF" CornerRadius="16" Padding="16,12"
                        IsVisible="{Binding IsSyncing}">
                    <StackPanel Spacing="8">
                        <TextBlock Text="{Binding ProgressText}" FontSize="13"
                                   FontWeight="Bold" Foreground="#667eea"/>
                        <ProgressBar Value="{Binding ProgressPercentage}" Minimum="0" Maximum="100"
                                     Width="150" Height="8" CornerRadius="4">
                            <ProgressBar.Foreground>
                                <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,0%">
                                    <GradientStop Color="#4FACFE" Offset="0"/>
                                    <GradientStop Color="#00F2FE" Offset="1"/>
                                </LinearGradientBrush>
                            </ProgressBar.Foreground>
                        </ProgressBar>
                    </StackPanel>
                </Border>

                <!-- Conflicts Warning (hidden for now - property doesn't exist yet) -->
                <Border CornerRadius="16" Padding="12,10" BoxShadow="0 4 8 0 #40FF6F00"
                        IsVisible="False" Cursor="Hand">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                            <GradientStop Color="#FFE66D" Offset="0"/>
                            <GradientStop Color="#FF6B6B" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBlock Text="âš ï¸" FontSize="16"/>
                        <TextBlock Text="View Conflicts" FontSize="13" FontWeight="Bold" Foreground="White"/>
                    </StackPanel>
                </Border>

                <!-- Last Sync Result -->
                <Border Background="#E0FFFFFF" CornerRadius="12" Padding="12,8"
                        IsVisible="{Binding LastSyncResult, Converter={x:Static ObjectConverters.IsNotNull}}">
                    <TextBlock Text="{Binding LastSyncResult}" FontSize="13"
                               Foreground="#4ECDC4" FontWeight="Bold"/>
                </Border>
            </StackPanel>
        </Grid>

        <!-- Loading Overlay -->
        <Border Grid.Row="0" Grid.RowSpan="3"
                Background="#F0FFFFFF"
                IsVisible="{Binding IsLoading}"
                CornerRadius="20">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="20">
                <TextBlock Text="ðŸ”„" FontSize="48" HorizontalAlignment="Center">
                    <TextBlock.RenderTransform>
                        <RotateTransform />
                    </TextBlock.RenderTransform>
                    <TextBlock.Styles>
                        <Style Selector="TextBlock">
                            <Style.Animations>
                                <Animation Duration="0:0:1" IterationCount="Infinite">
                                    <KeyFrame Cue="0%">
                                        <Setter Property="(RotateTransform.Angle)" Value="0" />
                                    </KeyFrame>
                                    <KeyFrame Cue="100%">
                                        <Setter Property="(RotateTransform.Angle)" Value="360" />
                                    </KeyFrame>
                                </Animation>
                            </Style.Animations>
                        </Style>
                    </TextBlock.Styles>
                </TextBlock>
                <TextBlock Text="Loading folders..." Foreground="#667eea" FontSize="16" FontWeight="Bold"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
