<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:syncronisation="using:AStar.Dev.OneDrive.Client.Syncronisation"
             xmlns:models1="clr-namespace:AStar.Dev.OneDrive.Client.Core.Models;assembly=AStar.Dev.OneDrive.Client.Core"
             x:Class="AStar.Dev.OneDrive.Client.Syncronisation.SyncTreeViewProfessional"
             x:DataType="syncronisation:SyncTreeViewModel">

    <Design.DataContext>
        <syncronisation:SyncTreeViewModel />
    </Design.DataContext>

    <UserControl.Styles>
        <Style Selector="Button.primary">
            <Setter Property="Background" Value="#0078D4"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>

        <Style Selector="Button.primary:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#106EBE"/>
        </Style>

        <Style Selector="Button.secondary">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#0078D4"/>
            <Setter Property="BorderBrush" Value="#0078D4"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="CornerRadius" Value="4"/>
        </Style>
    </UserControl.Styles>

    <Grid RowDefinitions="Auto,*,Auto">
        <!-- Header -->
        <StackPanel Grid.Row="0" Spacing="4" Margin="0,0,0,24">
            <Grid ColumnDefinitions="*,Auto">
                <StackPanel Grid.Column="0">
                    <TextBlock Text="Folder Selection" FontSize="22" FontWeight="SemiBold" Foreground="#1A1A1A"/>
                    <TextBlock Text="Choose folders to synchronize" FontSize="13" Foreground="#666666" Margin="0,2,0,0"/>
                </StackPanel>
                <Button Grid.Column="1" Content="Clear All" Command="{Binding ClearSelectionsCommand}"
                        Classes="secondary" VerticalAlignment="Center"/>
            </Grid>
        </StackPanel>

        <!-- Tree View -->
        <Border Grid.Row="1" Background="#F8F9FA" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="6">
            <ScrollViewer Padding="12">
                <TreeView ItemsSource="{Binding Folders}" SelectionMode="Single" Background="Transparent" BorderThickness="0">
                    <TreeView.Styles>
                        <Style Selector="TreeViewItem" x:DataType="models1:OneDriveFolderNode">
                            <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
                            <Setter Property="Padding" Value="8,6"/>
                        </Style>
                    </TreeView.Styles>

                    <TreeView.ItemTemplate>
                        <TreeDataTemplate ItemsSource="{Binding Children}" x:DataType="models1:OneDriveFolderNode">
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <CheckBox IsChecked="{Binding IsSelected}" IsThreeState="True" VerticalAlignment="Center"/>
                                <PathIcon Data="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"
                                          Width="16" Height="16" Foreground="#0078D4" VerticalAlignment="Center"/>
                                <Viewbox Width="14" Height="14" IsVisible="{Binding IsLoading}">
                                    <Path Data="M 8,2 A 6,6 0 1 1 2,8"
                                          Stroke="#0078D4"
                                          StrokeThickness="1.5"
                                          StrokeLineCap="Round"
                                          Classes="spinner" />
                                </Viewbox>
                                <TextBlock Text="{Binding Name}" FontSize="13" Foreground="#1A1A1A" VerticalAlignment="Center"/>
                            </StackPanel>
                        </TreeDataTemplate>
                    </TreeView.ItemTemplate>
                </TreeView>
            </ScrollViewer>
        </Border>

        <!-- Footer Actions -->
        <Grid Grid.Row="2" Margin="0,16,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0" Content="{Binding SyncButtonText}" Command="{Binding StartSyncCommand}"
                    Classes="primary" MinWidth="120" Margin="0,0,8,0" IsEnabled="{Binding !IsLoading}"/>
            <Button Grid.Column="1" Content="Show Progress" Command="{Binding OpenSyncProgressCommand}"
                    Classes="secondary" MinWidth="120" Margin="0,0,8,0"
                    IsVisible="{Binding IsSyncing}" IsEnabled="{Binding !IsSyncProgressOpen}"/>
            <Button Grid.Column="2" Content="Cancel" Command="{Binding CancelSyncCommand}"
                    Classes="secondary" MinWidth="100" Margin="0,0,8,0" IsVisible="{Binding IsSyncing}"/>

            <!-- Status Info -->
            <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="16" HorizontalAlignment="Right" VerticalAlignment="Center">
                <!-- Progress -->
                <StackPanel Orientation="Horizontal" Spacing="8" IsVisible="{Binding IsSyncing}">
                    <ProgressBar Value="{Binding ProgressPercentage}" Minimum="0" Maximum="100"
                                 Width="120" Height="6" VerticalAlignment="Center" Foreground="#0078D4"/>
                    <TextBlock Text="{Binding ProgressText}" FontSize="12" Foreground="#666666" VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Conflicts Warning -->
                <Border Background="#FFF3E0" BorderBrush="#FF6F00" BorderThickness="1" CornerRadius="4" Padding="8,6"
                        IsVisible="False">
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <PathIcon Data="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"
                                  Width="14" Height="14" Foreground="#E65100"/>
                        <TextBlock Text="View Conflicts" FontSize="12" FontWeight="SemiBold" Foreground="#E65100"/>
                    </StackPanel>
                </Border>

                <!-- Last Sync Result -->
                <TextBlock Text="{Binding LastSyncResult}" FontSize="12" Foreground="#0078D4" FontWeight="SemiBold"
                           IsVisible="{Binding LastSyncResult, Converter={x:Static ObjectConverters.IsNotNull}}"/>
            </StackPanel>
        </Grid>

        <!-- Loading Overlay -->
        <Border Grid.Row="0" Grid.RowSpan="3"
                Background="#F0FFFFFF"
                IsVisible="{Binding IsLoading}"
                CornerRadius="6">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="16">
                <ProgressBar IsIndeterminate="True"
                             Width="200"
                             Foreground="#0078D4" />
                <TextBlock Text="Loading folder structure..." Foreground="#666666" FontSize="13"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
