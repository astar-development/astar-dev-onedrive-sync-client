<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:AStarOneDriveClient.ViewModels"
             mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="400"
             x:Class="AStarOneDriveClient.Views.AccountManagementView"
             x:DataType="vm:AccountManagementViewModel">

    <Design.DataContext>
        <vm:AccountManagementViewModel />
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*,Auto" Margin="20">
        <!-- Title -->
        <TextBlock Grid.Row="0"
                   Text="OneDrive Account Management"
                   FontSize="20"
                   FontWeight="Bold"
                   Margin="0,0,0,20" />

        <!-- Accounts List -->
        <Border Grid.Row="1"
                BorderBrush="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                BorderThickness="1"
                CornerRadius="4"
                Padding="10"
                Margin="0,0,0,20">
            <ScrollViewer>
                <ListBox ItemsSource="{Binding Accounts}"
                         SelectedItem="{Binding SelectedAccount}"
                         MinHeight="200">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <!-- Account Icon -->
                                <Ellipse Width="32" Height="32" Fill="{DynamicResource SystemAccentColor}" />

                                <!-- Account Info -->
                                <StackPanel>
                                    <TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold" />
                                    <StackPanel Orientation="Horizontal" Spacing="5">
                                        <TextBlock Text="Authenticated:" FontSize="11" />
                                        <TextBlock Text="{Binding IsAuthenticated}" FontSize="11" FontWeight="SemiBold" />
                                    </StackPanel>
                                </StackPanel>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>

                    <!-- Empty state -->
                    <ListBox.Styles>
                        <Style Selector="ListBox:empty">
                            <Setter Property="Template">
                                <ControlTemplate>
                                    <TextBlock Text="No accounts configured. Click 'Add Account' to get started."
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                               Margin="20" />
                                </ControlTemplate>
                            </Setter>
                        </Style>
                    </ListBox.Styles>
                </ListBox>
            </ScrollViewer>
        </Border>

        <!-- Action Buttons -->
        <Grid Grid.Row="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <Button Grid.Row="0" Grid.Column="0"
                    Content="Add Account"
                    Command="{Binding AddAccountCommand}"
                    IsEnabled="{Binding !IsLoading}"
                    Margin="0,0,5,5"
                    HorizontalAlignment="Stretch" />

            <Button Grid.Row="0" Grid.Column="1"
                    Content="Remove Account"
                    Command="{Binding RemoveAccountCommand}"
                    IsEnabled="{Binding !IsLoading}"
                    Margin="5,0,0,5"
                    HorizontalAlignment="Stretch" />

            <Button Grid.Row="1" Grid.Column="0"
                    Content="Login"
                    Command="{Binding LoginCommand}"
                    IsEnabled="{Binding !IsLoading}"
                    Margin="0,5,5,0"
                    HorizontalAlignment="Stretch" />

            <Button Grid.Row="1" Grid.Column="1"
                    Content="Logout"
                    Command="{Binding LogoutCommand}"
                    IsEnabled="{Binding !IsLoading}"
                    Margin="5,5,0,0"
                    HorizontalAlignment="Stretch" />
        </Grid>

        <!-- Toast (top-right) -->
        <Border Grid.Row="0"
                IsVisible="{Binding ToastVisible}"
                Background="Transparent"
                HorizontalAlignment="Right"
                VerticalAlignment="Top"
                Margin="0,10,10,0"
                ZIndex="100">
            <Border Background="#CC333333" CornerRadius="6" Padding="10" MinWidth="200">
                <TextBlock Text="{Binding ToastMessage}"
                           Foreground="White"
                           TextWrapping="Wrap" />
            </Border>
        </Border>

        <!-- Loading Indicator -->
        <Border Grid.Row="0" Grid.RowSpan="3"
                Background="#80000000"
                IsVisible="{Binding IsLoading}">
            <StackPanel HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Spacing="10">
                <ProgressBar IsIndeterminate="True" Width="200" />
                <TextBlock Text="Loading..."
                           Foreground="White"
                           HorizontalAlignment="Center" />
            </StackPanel>
        </Border>
    </Grid>
</UserControl>