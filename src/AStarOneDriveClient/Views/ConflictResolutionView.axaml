<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:AStarOneDriveClient.ViewModels"
             xmlns:enums="using:AStarOneDriveClient.Models.Enums"
             x:Class="AStarOneDriveClient.Views.ConflictResolutionView"
             x:DataType="vm:ConflictResolutionViewModel">

    <Design.DataContext>
        <vm:ConflictResolutionViewModel />
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*,Auto"
          Margin="20"
          Background="{DynamicResource SystemControlBackgroundAltHighBrush}">

        <!-- Header -->
        <StackPanel Grid.Row="0" Spacing="10" Margin="0,0,0,20">
            <TextBlock Text="Conflict Resolution"
                       FontSize="24"
                       FontWeight="Bold" />
            <TextBlock Text="Files have been modified both locally and remotely. Choose how to resolve each conflict:"
                       TextWrapping="Wrap"
                       Foreground="{DynamicResource SystemAccentColor}"
                       Opacity="0.8" />
            <TextBlock Text="{Binding StatusMessage}"
                       TextWrapping="Wrap"
                       FontWeight="SemiBold" />
        </StackPanel>

        <!-- Conflicts List -->
        <ScrollViewer Grid.Row="1" IsVisible="{Binding HasConflicts}">
            <ItemsControl ItemsSource="{Binding Conflicts}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="vm:ConflictItemViewModel">
                        <Border BorderBrush="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                BorderThickness="1"
                                CornerRadius="4"
                                Padding="15"
                                Margin="0,0,0,15">
                            <Grid RowDefinitions="Auto,Auto,Auto,Auto">

                                <!-- File Path -->
                                <TextBlock Grid.Row="0"
                                           Text="{Binding FilePath}"
                                           FontWeight="Bold"
                                           FontSize="16"
                                           Margin="0,0,0,10" />

                                <!-- Conflict Details -->
                                <Grid Grid.Row="1" ColumnDefinitions="Auto,*,Auto,*" RowDefinitions="Auto,Auto" Margin="0,0,0,15">
                                    <TextBlock Grid.Row="0" Grid.Column="0"
                                               Text="Local:"
                                               FontWeight="SemiBold"
                                               Margin="0,0,10,5" />
                                    <TextBlock Grid.Row="0" Grid.Column="1"
                                               Text="{Binding LocalDetailsDisplay}"
                                               Margin="0,0,0,5" />

                                    <TextBlock Grid.Row="1" Grid.Column="0"
                                               Text="Remote:"
                                               FontWeight="SemiBold"
                                               Margin="0,0,10,0" />
                                    <TextBlock Grid.Row="1" Grid.Column="1"
                                               Text="{Binding RemoteDetailsDisplay}" />
                                </Grid>

                                <!-- Resolution Strategy Selection -->
                                <TextBlock Grid.Row="2"
                                           Text="Choose resolution:"
                                           FontWeight="SemiBold"
                                           Margin="0,0,0,8" />

                                <StackPanel Grid.Row="3" Spacing="8">
                                    <RadioButton Content="Keep Local (upload local version)"
                                                 GroupName="{Binding Id}"
                                                 IsChecked="{Binding SelectedStrategy, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static enums:ConflictResolutionStrategy.KeepLocal}}" />
                                    <RadioButton Content="Keep Remote (download remote version)"
                                                 GroupName="{Binding Id}"
                                                 IsChecked="{Binding SelectedStrategy, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static enums:ConflictResolutionStrategy.KeepRemote}}" />
                                    <RadioButton Content="Keep Both (rename local, download remote)"
                                                 GroupName="{Binding Id}"
                                                 IsChecked="{Binding SelectedStrategy, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static enums:ConflictResolutionStrategy.KeepBoth}}" />
                                    <RadioButton Content="Skip (don't resolve now)"
                                                 GroupName="{Binding Id}"
                                                 IsChecked="{Binding SelectedStrategy, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static enums:ConflictResolutionStrategy.None}}" />
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- No Conflicts Message -->
        <TextBlock Grid.Row="1"
                   Text="No conflicts to display."
                   FontSize="18"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"
                   IsVisible="{Binding !HasConflicts}" />

        <!-- Action Buttons -->
        <StackPanel Grid.Row="2"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Spacing="10"
                    Margin="0,20,0,0">
            <Button Content="Resolve All"
                    Command="{Binding ResolveAllCommand}"
                    IsEnabled="{Binding !IsResolving}"
                    Classes="accent" />
            <Button Content="Cancel"
                    Command="{Binding CancelCommand}"
                    IsEnabled="{Binding !IsResolving}" />
        </StackPanel>

        <!-- Loading Overlay -->
        <Border Grid.Row="0" Grid.RowSpan="3"
                Background="#80000000"
                IsVisible="{Binding IsLoading}">
            <StackPanel HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Spacing="10">
                <ProgressBar IsIndeterminate="True"
                             Width="200"
                             Foreground="#00E5FF" />
                <TextBlock Text="Loading conflicts..."
                           Foreground="White"
                           HorizontalAlignment="Center" />
            </StackPanel>
        </Border>

        <!-- Resolving Overlay -->
        <Border Grid.Row="0" Grid.RowSpan="3"
                Background="#80000000"
                IsVisible="{Binding IsResolving}">
            <StackPanel HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Spacing="10">
                <ProgressBar IsIndeterminate="True"
                             Width="200"
                             Foreground="#00E5FF" />
                <TextBlock Text="{Binding StatusMessage}"
                           Foreground="White"
                           HorizontalAlignment="Center"
                           TextWrapping="Wrap"
                           MaxWidth="300" />
            </StackPanel>
        </Border>
    </Grid>
</UserControl>